<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<title>事例</title>
<meta
	content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
	name='viewport' />
<link rel="stylesheet" href="../static/css/bootstrap.min.css">
<link rel="stylesheet" href="../static/css/ready.css">
<style>
ul,
			h2 {
				padding: 0;
				margin: 0;
			}
			
			li {
				list-style: none;
			}
			
			#list {
				width: 240px;
				border: 1px solid #ccc;
				margin: 0 auto;
			}
			
			#list .lis {}
			
			#list h2 {
				height: 30px;
				line-height: 30px;
				text-indent: 20px;
				/*文字缩进20px*/
				background: url(img/ico1.gif) no-repeat 5px center pink;
				/*前面小箭头*/
				cursor: pointer;
			}
			
			.h2,
			h2 {
				font-size: 1rem;
			}
			
			#list .active {
				/* 点击时添加的类名 */
				background: url(img/ico2.gif) no-repeat 5px center #ff9;
			}
			
			#list ul {
				display: none;
			}
			
			#list ul li {
				line-height: 24px;
				border-bottom: 2px solid #fc4;
				text-indent: 24px;
				/*文字缩进24px*/
			}
			
			#stulist [type="checkbox"]:not(:checked)+.form-check-sign:after,
			#stulist [type="checkbox"]:checked+.form-check-sign:after {
				content: "\f17b";
				display: inline-block;
				position: absolute;
				top: -1px;
				left: -22px;
				width: 18px;
				height: 18px;
				text-align: center;
				font-size: 1.5em;
				line-height: 0.8;
				color: #4D7CFE;
				transition: all .2s;
				font-family: LineAwesome;
			}

.has-success .form-control {
	border-color: #ced4da;
	color: black;
}

.modalbox {
	border: 1px solid #ced4da;
	margin-top: 20px;
}

.modalbox button {
	float: right;
	margin-right: 10px
}

.modelinfo {
	display: flex;
	flex-direction: column;
	padding: 5px;
}

#pagebox {
	display: flex;
	justify-content: flex-end;
}
/* #btnsubmit button:nth-child(1){
				margin-top: 20px;
				width: 100px;
				float: left;
			} */
/* #btnsubmit button:nth-child(2){
				margin-top: 20px;
				width: 100px;
				float: right;
			} */
#btnsubmit {
	display: flex;
	justify-content: space-between;
}
</style>
</head>

<body>
	<div class="main-panel">
		<div class="content">
			<div class="container-fluid">
				<h4 class="page-title">发布作业</h4>
				<div class="row">
					<div class="col-md-12">
						<div class="card">
							<div class="card-header">
								<h4 class="card-title">选择班级</h4>
							</div>
							<div class="card-body">
								<table
									class="table table-bordered table-bordered-bd-warning mt-4"
									id="AdminclassDatas">
									<thead>
										<tr>
											<th scope="col">操作</th>
											<th scope="col">年级</th>
											<th scope="col">班级</th>
										</tr>
									</thead>
									<tbody>
										<tr v-for="(obj,index) in list">
											<td><label
												class="form-check-label"><!--  <input
													class="clazzInput" type="checkbox" value=""  v-bind:data-id="obj.id"> -->
													<input type="checkbox" class="clazzInput" v-bind:data-id="obj.id">
													<span class="form-check-sign"></span></td>
											<td>{{obj.cname}}</td>
											<td>{{obj.greaName}}</td>
										</tr>
										<!-- <tr>
												<td>
													<label class="form-check-label">
													<input class="form-check-input" type="checkbox" value="">
													<span class="form-check-sign"></span>
												</td>
												<td>S1</td>
												<td>1803</td>
											</tr>
											<tr>
												<td>
													<label class="form-check-label">
													<input class="form-check-input" type="checkbox" value="">
													<span class="form-check-sign"></span>
												</td>
												<td>Y2</td>
												<td>java20</td>
											</tr> -->
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="card">
							<div class="card-header">
								<h4 class="card-title">发布作业</h4>
							</div>
							<div class="card-body">
								<div class="form-group has-success">
									<label for="successInput">作业名称</label> 
									<input type="hidden"
										 class="form-control" name="wid">
									<input type="text"
										 class="form-control" name="workname" readonly="readonly">
								</div>
								<div class="form-group has-success">
									<label for="successInput">开始时间</label> <!-- <input type="text"
										id="successInput" class="form-control" name="starttime"> -->
										<input type="date" id="successInput" class="form-control"  name="starttime"/>
								</div>
								<div class="form-group has-success">
									<label for="successInput">结束时间</label><!--  <input type="text"
										id="successInput" class="form-control" name="endtime"> -->
										<input type="date" id="successInput" class="form-control"  name="endtime"/>
								</div>
								<div class="form-group">
									<label for="comment">备注</label>
									<textarea class="form-control" id="comment" rows="5" name="message">

										</textarea>
								</div>
								<div id="btnsubmit">
									<button class="btn btn-danger">取消</button>
									<button class="btn btn-success">选择学生</button>
									<button class="btn btn-success" id="publish">确认</button>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="card">
							<div class="card-header">
								<h4 class="card-title">作业模板</h4>
							</div>
							<div class="card-body" id="WorkMould">
								<div class="modalbox" v-for="(obj,index) in obj.list">
									<div class="modelinfo">
										<p>
											作业名称:<span>{{obj.name}}</span>
											
											<button class="btn btn-success use" v-bind:data-id="obj.id">使用</button>
											<button class="btn btn-success toPage" v-bind:data-id="obj.id">查看</button>
										</p>
										<p>
											发布时间:<span>{{obj.time}}</span>
										</p>
										<!-- <p>
											级别:<span>难</span>
										</p> -->
										<p>
											使用次数:<span>{{obj.count}}</span>
										</p>
									</div>
								</div>
								<!-- <div class="modalbox">
										<div class="modelinfo" v-for="(index,obj) in obj.list">
											<p>作业名称:<span>MySQL第一次作业</span><button class="btn btn-success">使用</button></p>
											<p>发布时间:<span>2019-02-01</span></p>
											<p>级别:<span>难</span></p>
											<p>使用次数:<span>1</span></p>
										</div>
									</div>
									<div class="modalbox">
										<div class="modelinfo">
											<p>作业名称:<span>MySQL第一次作业</span><button class="btn btn-success">使用</button></p>
											<p>发布时间:<span>2019-02-01</span></p>
											<p>级别:<span>难</span></p>
											<p>使用次数:<span>1</span></p>
										</div>
									</div> -->
							</div>
							<div id="pagebox">
								<p class="demo">
								<ul class="pagination pg-primary">
									<li class="page-item"><a class="page-link" href="#"
										aria-label="Previous"> <span aria-hidden="true">&laquo;</span>
											<span class="sr-only">Previous</span>
									</a></li>
									<li class="page-item active"><a class="page-link" href="#">1</a>
									</li>
									<li class="page-item"><a class="page-link" href="#">2</a>
									</li>
									<li class="page-item"><a class="page-link" href="#">3</a>
									</li>
									<li class="page-item"><a class="page-link" href="#"
										aria-label="Next"> <span aria-hidden="true">&raquo;</span>
											<span class="sr-only">Next</span>
									</a></li>
								</ul>
								</p>
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="card">
							<div class="card-header">
								<h4 class="card-title">选择学生</h4>
							</div>
							<div class="card-body">
								<div id="stulist">
									<ul id="list">
										<li class="lis" v-for="(obj,index) in list" v-bind:data-id="obj.cid">
											<h2>{{obj.cname}}</h2>
											<ul>
												<li style="display: flex; justify-content: space-around" v-for="(obj,index) in obj.list">
													<div>
														<label class="form-check-label"> <input
															class="stuinput" type="checkbox" value="" v-bind:data-id="obj.studentid">
															<span class="form-check-sign"></span>
														</label>
													</div>
													<div>
														</span>{{obj.studentname}}<span>
													</div>

												</li>
												<!-- <li style="display: flex; justify-content: space-around">
													<div>
														<label class="form-check-label"> <input
															class="form-check-input" type="checkbox" value="">
															<span class="form-check-sign"></span>
														</label> </label>
													</div>
													<div>
														</span>小明<span>
													</div>

												</li> -->
											</ul>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

</html>
<script src="../static/js/core/jquery.min.js"></script>
<script src="../static/js/core/vue.js"></script>
<script src="../static/js/core/jquery.cookie.js"></script>
<script>
	//作业模板
	var v = new Vue({
		el : "#WorkMould",
		data : {
			obj : null
		}
	})
	//管理的班级
	var classdatas = new Vue({
		el : "#AdminclassDatas",
		data : {
			list : null
		}
	})
	//管理的班级所有学生
	var listStu=new Vue({
		el:"#stulist",
		data:{
			list:null
		},updated:function(){
				var list = document.getElementById('list');
				var ah2 = list.getElementsByTagName('h2');
				var uls = list.getElementsByTagName('ul');
				// h2要和下面的ul进行匹配，所以我们要用索引值，给h2身上添加索引值
				for(var i = 0; i < ah2.length; i++) {
					ah2[i].index = i; //给h2添加索引值，点击谁就给谁添加索引值
					ah2[i].onclick = function() {
						if(this.className == '') { //判断所点击的h2标签是否有类，
							//this.index指h2身上的索引数，this指h2，h2的索引值为this.index
							uls[this.index].style.display = 'block';
							this.className = 'active'; //给当前点击的h2添加类，更改箭头方向
						} else {
							uls[this.index].style.display = 'none';
							this.className = '';
						}
					}
				}
		}
	})
	/*查询模板(分页)  */
	function getMouldPageData(cur, tid) {
		$.ajax({
			type : "post",
			url : "http://127.0.0.1:8080/topicWarehouseController/queryByTidMould",
			data : {
				tid : tid,
						cur : cur
			},
			success : function(data) {
				v.obj = data
			}
		})
	}
	$(function() {
		/*查询模板(分页)  */
		getMouldPageData(1, 1)
		/*查询教员管理的班级*/
		$.ajax({
				type : "post",
				url : "http://127.0.0.1:8080/topicWarehouseController/queryByTidResultClass",
				data : {
						tid : 1
					/* 暂时死值 tid教员id */
				},
				success : function(data) {
					/* console.log(JSON.stringify(data)) */
					classdatas.list = data;
				}
		})
		/* 查询管理的所有班级的学生 */
		$.ajax({
			type : "post",
			url : "http://127.0.0.1:8080/topicWarehouseController/queryByTidAdminStuAll",
			data : {
					tid : 1
					/* 暂时死值 tid教员id */
			},
			success : function(data) {
				listStu.list=data;
			}
		})
		/*选中年级 并且选中所有的学生  */
		$("body").on("click",".clazzInput",function(){
				var id=$(this).attr("data-id")
				var li=$("#list").find(".lis[data-id="+id+"]")
			if($(this).is(":checked")){
				$(li).find("input[type=checkbox]").attr("checked","checked");
			}else{
				$(li).find("input[type=checkbox]").removeAttr("checked");
			}
				
		})
		 $("body").on("click",".stuinput",function(){
			var id=$(this).parents(".lis").attr("data-id")
			if($(this).is(":checked")){
				$(".clazzInput[data-id="+id+"]").attr("checked","checked");
			}else{
				$(".clazzInput[data-id="+id+"]").removeAttr("checked");
			}
		}) 
		
		$("body").on("click",".use",function(){
			var name=$(this).prev().html();
			$("[name=workname]").val(name)
			var id=$(this).attr("data-id")
			$("[name=wid]").val(id)
		})
		
		$("#publish").click(function(){
			var obj={}
			var temp=[]
			if($("[name=wid]").val().trim()!="" && $("[name=workname]").val()!=""){
				$.each($(".clazzInput[type=checkbox]:checked"),function(){
					var obj={}
					obj.cid=$(this).attr("data-id")
					temp.push(obj)
				})
				for(var i=0 ;i<temp.length;i++){
						var list=[]
					$.each($(".stuinput[type=checkbox]:checked"),function(){
						if(temp[i].cid==$(this).parents(".lis").attr("data-id")){
							list.push($(this).attr("data-id"))
						}
					})
					temp[i].stus=list
				}
				var Workinstance={}
				Workinstance.starttime=$("[name=starttime]").val().trim()
				Workinstance.endtime=$("[name=endtime]").val().trim()
				Workinstance.message=$("[name=message]").val().trim()
				Workinstance.wid=$("[name=wid]").val()
				Workinstance.tid=1		//暂时死值
				obj.obj=Workinstance
				obj.list=temp;
				console.log(JSON.stringify(obj))
				$.ajax({
					type : "post",
					url : "http://127.0.0.1:8080/topicWarehouseController/WorkPublishParam",
					data :JSON.stringify(obj),
					contentType: 'application/json',
					success : function(data) {
						if(data>0){
							alert("作业发布成功！")
						}
	
					}
				})
			}else{
				alert("请选择试卷模板")
			}
			
			
			
		})
		//跳转到作业模板
		$("body").on("click",".toPage",function(){
			var id=$(this).attr("data-id")
			location.href="http://127.0.0.1:8080/WorkModel/toWorkModel?id="+id
			/* window.open("http://127.0.0.1:8080/WorkModel/toWorkModel") */
		})
	})
</script>