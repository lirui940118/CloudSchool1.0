<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<title>用户管理</title>
<meta
	content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
	name='viewport' />
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i">
<link rel="stylesheet" th:href="@{/static/css/bootstrap.min.css}">
<link rel="stylesheet" th:href="@{/static/css/ready.css}">
<link rel="stylesheet" th:href="@{/static/css/demo.css}">
<link rel="stylesheet" th:href="@{/static/css/load.css}">
<style type="text/css">
.card {
	margin-bottom: 10px;
}

#hezi {
	position: absolute;
	left: 0;
	top: 0;
	background: #f2f3f8;
	width: 100%;
	height: 100%;
	z-index: 9999;
}

.zxc {
	top: 80px;
}
</style>
</head>

<body>
	<div class="main-panel">
		<div id="hezi">
			<div class="spinner">
				<div class="spinner-container container1">
					<div class="circle1"></div>
					<div class="circle2"></div>
					<div class="circle3"></div>
					<div class="circle4"></div>
				</div>
				<div class="spinner-container container2">
					<div class="circle1"></div>
					<div class="circle2"></div>
					<div class="circle3"></div>
					<div class="circle4"></div>
				</div>
				<div class="spinner-container container3">
					<div class="circle1"></div>
					<div class="circle2"></div>
					<div class="circle3"></div>
					<div class="circle4"></div>
				</div>
			</div>
		</div>
		<div class="content">
			<div class="container-fluid">
				<h4 class="page-title">用户管理</h4>

				<div class="row">
					<div class="col-md-12">
						<div class="card">
							<div class="card-body">
								<p class="demo">
									<button infoBut moduleUrl="/staff/goAddStaff" name="goInsertStaff" class="btn btn-success">新增职员</button>
									<button infoBut moduleUrl="/user/goAddStudent" name="goInsertStudent" class="btn btn-success">新增学员</button>
									<button infoBut moduleUrl="/zzy/Goteacher_ability" name="updateStaff" class="btn btn-success">设置教员课程</button>
								</p>
							</div>
						</div>
					</div>

					<div class="col-md-12">
						<div class="card">
							<div class="card-header">
								<h4 class="card-title">筛选</h4>
							</div>
							<div class="card-body">
								<div class="form">
									<div class="form-group from-show-notify row">
										<div class="col-md-1 text-left">
											<label>搜索:</label>
										</div>
										<div class="col-md-3">
											<input type="search" class="form-control" v-model="filtrate"
												placeholder="名称/账号/角色/职位">
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-12">
						<div class="card">
							<div class="card-body">
								<table class="table table-striped mt-12">

									<thead >
										<tr>
											<th scope="col">名称</th>
											<th scope="col">账号</th>
											<th scope="col">角色</th>
											<th scope="col">职位</th>
											<th scope="col">操作</th>
										</tr>
									</thead>
									<tbody>
										<tr v-for="(p,index) in page.list">
											<td>{{p.name}}</td>
											<td>{{p.username}}</td>
											<td>{{p.rolename}}</td>
											<td>{{p.positionname}}</td>
											<td>
												<button    data-toggle="modal" v-on:click="getInfo(index)"
													data-target=".bs-example-modal-lg" name="goInsertRole"
													class="btn btn-success">修改用户</button>
											</td>
										</tr>
									</tbody>
								</table>
								<div id="pagebox">
									<p class="demo">
									<ul class="pagination pg-primary">
										<li class="page-item"><a class="page-link"
											href="javascript:void(0)" v-on:click="getPage(1)" aria-label="Previous"
											id="previousPage"> <span aria-hidden="true">&laquo;</span>
												<span class="sr-only">Previous</span>
										</a></li>
										<li   v-for="(n,index) in page.pageCount" v-bind:class="n == page.presentPage ? 'page-item active' : 'page-item'"><a class="page-link" href="#" v-on:click="getPage(index+1)">{{n}}</a>
										</li>
										<li class="page-item"><a class="page-link"
											href="javascript:void(0)" v-on:click="getPage(page.pageCount)" aria-label="Next" id="nextPage">
												<span aria-hidden="true">&raquo;</span> <span
												class="sr-only">Next</span>
										</a></li>
									</ul>
									</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
	</div>
	<div  id="modal" class="modal fade bs-example-modal-lg" tabindex="-1"
		role="dialog" aria-labelledby="myLargeModalLabel">
		<div class="modal-dialog modal-lg " role="document">
			<div class="modal-content zxc card">
				<div class="content  ">
					<div class="container-fluid">
						<div v-if="userinfo" class="col-lg-12 row">
							<h4 class="page-title col-lg-6"></h4>
						</div>
						<div class="card-body">
							<div class="form-group">
								<label for="largeInput">用户名称</label> <input type="text"
									class="form-control form-control" v-bind:value="userinfo.name" id="name"
									 placeholder="">
									 <input type="text"
									 v-bind:value="userinfo.userid" id="userid"
									 hidden="">
									  <input type="text"
									 v-bind:value="userinfo.usertypeid" id="usertypeid"
									 hidden="">
									  <input type="text"
									 v-bind:value="userinfo.usertypenub" id="usertypenub"
									 hidden="">
							</div>
							
							<div class="form-group">
								<label for="largeInput">用户账号</label> <input type="text"
									class="form-control form-control" v-bind:value="userinfo.username" id="username"
									 placeholder="">
							</div>
							
							<div class="form-group">
								<label for="largeInput">用户密码</label> <input type="password"
									class="form-control form-control" v-bind:value="userinfo.password" id="password"
									 placeholder="">
							</div>
							
							<div class="form-group">
								<label for="defaultSelect">角色</label> <select
									class="form-control form-control" id="role">
									<option v-for="r in role" v-bind:value="r.roleid"  v-bind:selected = r.roleid==userinfo.roleid?'selected':"" >{{r.rolename}}</option>
								</select>
							</div>
							
							<div class="form-group">
								<label for="defaultSelect">职位</label> <select
									class="form-control form-control" id="position">
									<option v-for="p in position" v-bind:value="p.positionid"   v-bind:selected = p.positionid==userinfo.positionid?'selected':"">{{p.positionname}}</option>
								</select>
							</div>
							<div  class="modal-footer">
								<button  type="button" onclick="updateUser()" class="btn btn-secondary" data-dismiss="modal">保存</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
				</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

</body>
<script th:src="@{/static/js/core/jquery.min.js}"></script>
<script th:src="@{/static/js/core/vue.js}" type="text/javascript"
	charset="utf-8"></script>
<script
	th:src="@{/static/js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js}"></script>
<script th:src="@{/static/js/core/popper.min.js}"></script>
<script th:src="@{/static/js/core/bootstrap.min.js}"></script>
<script th:src="@{/static/js/plugin/chartist/chartist.min.js}"></script>
<script
	th:src="@{/static/js/plugin/chartist/plugin/chartist-plugin-tooltip.min.js}"></script>
<script
	th:src="@{/static/js/plugin/bootstrap-notify/bootstrap-notify.min.js}"></script>
<script
	th:src="@{/static/js/plugin/bootstrap-toggle/bootstrap-toggle.min.js}"></script>
<script th:src="@{/static/js/plugin/jquery-mapael/jquery.mapael.min.js}"></script>
<script
	th:src="@{/static/js/plugin/jquery-mapael/maps/world_countries.min.js}"></script>
<script th:src="@{/static/js/plugin/chart-circle/circles.min.js}"></script>
<script
	th:src="@{/static/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js}"></script>
<script th:src="@{/static/js/ready.min.js}"></script>
<script th:src="@{/static/js/cqj_infoBut.js}"></script>
<script th:src="@{/static/js/axios.min.js}" type="text/javascript"
	charset="utf-8"></script>
<script th:src="@{/static/js/lodash.min.js}" type="text/javascript"
	charset="utf-8"></script>
	<script th:src="@{/static/js/cqj_infoBut.js}"></script>
	
<script type="text/javascript">
	var v = new Vue({
		el : ".content",
		data : {
			page : {},
			filtrate : ""
		},
		watch : {
			filtrate : function() {
				this.getAnswer();
			}
		},
		methods : {
			getAnswer : _.debounce(function() {
				getPage(1);
			},
			// 这是我们为用户停止输入等待的毫秒数
			500),
			getInfo : function(index) {
				getInfo(index);
			},
			getPage : function(index) {
				getPage(index);
			}
		}
	});
	
	/* 查询访谈详情 */
	var M = new Vue({
		el : "#modal",
		data : {
			userinfo : null,
			position:{},
			role:{}
		}
	});
	var count = 0;
	var sumCount =4;
	$(function() {
		
		infoBut.ccc();
		getRole();
		getPosition();
		getPage(1);
		$('[name="goInsertStaff"]').click(function(){
			window.location.href="/staff/goAddStaff";
		});
		
		$('[name="goInsertStudent"]').click(function(){
			window.location.href="/user/goAddStudent";
		});
		$('[name="updateStaff"]').click(function(){
			window.location.href="/zzy/Goteacher_ability";
		});
	})
	//获取所有status为0的职位	
		function getPosition(){
			$.ajax({
				url : "/position/getPosition",
				data : null,
				type : "post",
				dataType : "json",
				success : function(data) {
					if(data!="404"){
						M.position=data;
					}
					infoBut.fadeOut();
				}
			})
		}
	//获取所有status为0的角色	
		function getRole(){
			$.ajax({
				url : "/role/getRole",
				data : null,
				type : "post",
				dataType : "json",
				success : function(data) {
					if(data!="404"){
						M.role=data;
					}
					infoBut.fadeOut();
				}
			})
		}
	function getInfo(i) {
		console.log(v.page.list[i]);
		M.userinfo = v.page.list[i];
	}
	//通过传值获取模块信息
	function getPage(i) {
		var json = {};
		json.cur = i;
		json.filtrate = v.filtrate;
		$.ajax({
			url : "/user/getPage",
			data : json,
			type : "post",
			dataType : "json",
			success : function(data) {
				
				console.log(data)
				if(data!="404"){
					v.page = data;
				}
				infoBut.fadeOut();
			}
		})
	}
	function updateUser(){
		var json={};
		json.usertypeid=document.querySelector("#usertypeid").value;
		json.usertypenub=document.querySelector("#usertypenub").value;
		json.userid=document.querySelector("#userid").value;
		json.name=document.querySelector("#name").value;
		json.username=document.querySelector("#username").value;
		json.password=document.querySelector("#password").value;
		json.roleid=$('#role option:selected') .val();//选中的值
		json.positionid=$('#position option:selected') .val();//选中的值
		console.log(json);
		$.ajax({
			url : "/user/updateUser",
			data : json,
			type : "post",
			dataType : "json",
			success : function(data) {
				console.log(data)
				getPage(1);
			}
		})
	}
</script>

</html>